"use strict";(self.webpackChunkmy_api_app=self.webpackChunkmy_api_app||[]).push([[172],{4172:(Se,R,a)=>{a.r(R),a.d(R,{routes:()=>ke});var l=a(6895),L=a(5698),t=a(8274);function G(o,e,n,r,i,s,c){try{var p=o[s](c),v=p.value}catch(y){return void n(y)}p.done?e(v):Promise.resolve(v).then(r,i)}function u(o){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=o.apply(e,n);function c(v){G(s,r,i,c,p,"next",v)}function p(v){G(s,r,i,c,p,"throw",v)}c(void 0)})}}var B=a(1135),Q=a(727);class H extends Q.w0{constructor(e,n){super()}schedule(e,n=0){return this}}const U={setInterval(o,e,...n){const{delegate:r}=U;return r?.setInterval?r.setInterval(o,e,...n):setInterval(o,e,...n)},clearInterval(o){const{delegate:e}=U;return(e?.clearInterval||clearInterval)(o)},delegate:void 0};var K=a(8737);const q={now:()=>(q.delegate||Date).now(),delegate:void 0};class _{constructor(e,n=_.now){this.schedulerActionCtor=e,this.now=n}schedule(e,n=0,r){return new this.schedulerActionCtor(this,e).schedule(r,n)}}_.now=q.now;const W=new class V extends _{constructor(e,n=_.now){super(e,n),this.actions=[],this._active=!1}flush(e){const{actions:n}=this;if(this._active)return void n.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=n.shift());if(this._active=!1,r){for(;e=n.shift();)e.unsubscribe();throw r}}}(class X extends H{constructor(e,n){super(e,n),this.scheduler=e,this.work=n,this.pending=!1}schedule(e,n=0){var r;if(this.closed)return this;this.state=e;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,n)),this.pending=!0,this.delay=n,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(s,this.id,n),this}requestAsyncId(e,n,r=0){return U.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,n,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return n;null!=n&&U.clearInterval(n)}execute(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,n);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,n){let i,r=!1;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:n}=this,{actions:r}=n;this.work=this.state=this.scheduler=null,this.pending=!1,(0,K.P)(r,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,super.unsubscribe()}}});var N=a(4482),O=a(5403),te=a(4671);function re(o,e){return o===e}var oe=a(9635),f=a(3900),T=a(2076),P=a(2843),z=a(9646),m=a(4004),ie=a(3099),S=a(8959);function Y(o){const e=new Uint32Array(o/2);return crypto.getRandomValues(e),Array.from(e,n=>("0"+n.toString(16)).slice(-2)).join("")}function I(){return(I=u(function*(o){const n=(new TextEncoder).encode(o);return crypto.subtle.digest("SHA-256",n)})).apply(this,arguments)}var j=a(529),h=a(955);const F="google-token",E="google-state-",J="https://oauth2.googleapis.com/token";class g{constructor(e,n,r){this.configuration=e,this.http=n,this.router=r,this.tokenReadySubject=new B.X(null),this.tokenReady$=this.tokenReadySubject.asObservable().pipe(function ee(o,e=W){return(0,N.e)((n,r)=>{let i=null,s=null,c=null;const p=()=>{if(i){i.unsubscribe(),i=null;const y=s;s=null,r.next(y)}};function v(){const y=c+o,$=e.now();if($<y)return i=this.schedule(void 0,y-$),void r.add(i);p()}n.subscribe((0,O.x)(r,y=>{s=y,c=e.now(),i||(i=e.schedule(v,o),r.add(i))},()=>{p(),r.complete()},void 0,()=>{s=i=null}))})}(100),function ne(o,e=te.y){return o=o??re,(0,N.e)((n,r)=>{let i,s=!0;n.subscribe((0,O.x)(r,c=>{const p=e(c);(s||!o(i,p))&&(s=!1,i=p,r.next(c))}))})}()),this.storeTokenDataPipe=(0,oe.z)((0,f.w)(i=>(0,T.D)(this.storeTokenData(i)))),(0,T.D)(this.getAvailableTokenData()).subscribe(({available:i,tokenData:s})=>{null===this.tokenReadySubject.value&&this.tokenReadySubject.next(i||void 0!==s?.refresh_token)})}loadData(e){return u(function*(){return JSON.parse(localStorage.getItem(e)??"null")})()}storeData(e,n){return u(function*(){return localStorage.setItem(e,JSON.stringify(n))})()}removeData(e){return u(function*(){return localStorage.removeItem(e)})()}loadKeys(){return u(function*(){const e=[];for(let n=0;n<localStorage.length;n++)e.push(localStorage.key(n)??"");return e})()}loadStateData(e){var n=this;return u(function*(){const r=Date.now(),i=`${E}${e}`;for(const s of yield n.loadKeys())s.startsWith(E)&&((yield n.loadData(s))?.expiredAt??0)<=r&&n.removeData(s);return n.loadData(i)})()}storeStateData(e,n){var r=this;return u(function*(){const i={...n,expiredAt:Date.now()+6e5};return yield r.storeData(`${E}${e}`,i),i})()}removeStateData(e){var n=this;return u(function*(){const r=yield n.loadStateData(e);return yield n.removeData(`${E}${e}`),r})()}loadTokenData(){var e=this;return u(function*(){return yield e.loadData(F)})()}storeTokenData(e){var n=this;return u(function*(){const r=Date.now(),i={...e},s=yield n.loadTokenData();return!i.refresh_token&&s?.refresh_token&&(i.refresh_token=s.refresh_token),void 0===i.expiredAt&&(i.expiredAt=r+1e3*i.expires_in-1e4),yield n.storeData(F,i),n.tokenReadySubject.next(!0),i})()}removeTokenData(){var e=this;return u(function*(){yield e.removeData(F),e.tokenReadySubject.next(!1)})()}refreshTokenData(e){return this.http.post(J,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:e}).pipe(this.storeTokenDataPipe)}exchangeCodeForToken(e,n,r){return(0,T.D)(this.removeStateData(n)).pipe((0,f.w)(i=>r?(0,P._)(()=>r):(0,z.of)(i)),(0,f.w)(i=>i?this.http.post(J,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:e,code_verifier:i.verifierCode,grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe(this.storeTokenDataPipe,(0,m.U)(()=>i)):(0,P._)(()=>new S.YP(n))))}getAuthorizationLink(){const e=Y(56);return(0,T.D)(function ce(o){return I.apply(this,arguments)}(e)).pipe((0,m.U)(n=>function se(o,e=!1){let n="";const r=new Uint8Array(o),i=r.byteLength;for(let c=0;c<i;c++)n+=String.fromCharCode(r[c]);const s=btoa(n);return e?function ae(o){return o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(s):s}(n,!0)),(0,f.w)(n=>{const r=Y(16);return(0,T.D)(this.storeStateData(r,{verifierCode:e,redirectUrl:this.router.url})).pipe((0,m.U)(()=>({challengeCode:n,securityToken:r})))}),(0,m.U)(({challengeCode:n,securityToken:r})=>{const i=new URL("https://accounts.google.com/o/oauth2/v2/auth");return i.searchParams.set("response_type","code"),i.searchParams.set("client_id",this.configuration.client_id),i.searchParams.set("scope",this.configuration.scopes.join(" ")),i.searchParams.set("redirect_uri",this.configuration.redirect_uri),i.searchParams.set("code_challenge",n),i.searchParams.set("code_challenge_method","S256"),i.searchParams.set("state",new URLSearchParams({security_token:r}).toString()),i.searchParams.append("prompt","consent"),i.searchParams.append("access_type","offline"),i}))}getAvailableTokenData(){return(0,T.D)(this.loadTokenData()).pipe((0,m.U)(e=>{const n=Date.now();return{available:(e?.expiredAt??0)>n,tokenData:e}}))}tryGetTokenData(){return(0,T.D)(this.getAvailableTokenData()).pipe((0,f.w)(({available:e,tokenData:n})=>e||void 0!==n?.refresh_token?this.refreshTokenData(n?.refresh_token??""):(0,z.of)(null)),(0,ie.B)())}getAccessToken(){return this.tryGetTokenData().pipe((0,m.U)(e=>e?.access_token??null))}getAuthorizationHeader(){return this.tryGetTokenData().pipe((0,f.w)(e=>e?(0,z.of)(`${e.token_type} ${e.access_token}`):(0,P._)(()=>new S.kG)))}forceExpired(){var e=this;return u(function*(){const n=yield e.loadTokenData();n&&(n.expiredAt=0,yield e.storeTokenData(n))})()}deleteToken(){var e=this;return u(function*(){yield e.removeTokenData()})()}}g.\u0275fac=function(e){return new(e||g)(t.LFG(S.tL),t.LFG(j.eN),t.LFG(h.F0))},g.\u0275prov=t.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"});class D{constructor(e,n,r){this.tokenService=e,this.route=n,this.router=r,this.errorMessage=null}ngOnInit(){const e=this.route.snapshot.queryParams,n=new URLSearchParams(e.state).get("security_token");e.code&&n&&this.tokenService.exchangeCodeForToken(e.code,n,e.error).pipe((0,L.q)(1)).subscribe({next:r=>this.router.navigateByUrl(r.redirectUrl),error:r=>{this.errorMessage=r.error?.error?r.error?.error:r instanceof Error?r.message:r}})}}D.\u0275fac=function(e){return new(e||D)(t.Y36(g),t.Y36(h.gz),t.Y36(h.F0))},D.\u0275cmp=t.Xpm({type:D,selectors:[["google-authorization-page"]],standalone:!0,features:[t.jDz],decls:2,vars:1,template:function(e,n){1&e&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&e&&(t.xp6(1),t.Oqu(n.errorMessage))},dependencies:[l.ez]});var d=a(433);class C{constructor(e){this.data=null,this.dataSubmited=new t.vpe,this.fb=e.nonNullable}ngOnInit(){const e=this.data??{};this.formGroup=this.fb.group({summary:this.fb.control(e.summary??"",{validators:[d.kI.required],updateOn:"blur"}),start:this.fb.group({dateTime:this.fb.control(this.formatDateTimeLocal(e.start?.dateTime??""),{validators:[d.kI.required],updateOn:"blur"})}),end:this.fb.group({dateTime:this.fb.control(this.formatDateTimeLocal(e.end?.dateTime??""),{validators:[d.kI.required],updateOn:"blur"})})})}formatDateTimeLocal(e){return""===e?"":(0,l.p6)(e,"YYYY-MM-ddThh:mm","en-EN")}onSubmit(){if(this.formGroup.valid){const e=this.formGroup.value,n={summary:e.summary??"",start:{dateTime:e.start?.dateTime?new Date(e.start.dateTime):new Date},end:{dateTime:e.end?.dateTime?new Date(e.end.dateTime):new Date}};this.dataSubmited.emit(n)}}}C.\u0275fac=function(e){return new(e||C)(t.Y36(d.qu))},C.\u0275cmp=t.Xpm({type:C,selectors:[["google-event-form"]],inputs:{data:"data"},outputs:{dataSubmited:"dataSubmited"},standalone:!0,features:[t.jDz],decls:17,vars:1,consts:[[3,"formGroup","ngSubmit"],["for","inp-summary"],["type","text","id","inp-summary","formControlName","summary"],["formGroupName","start"],["for","inp-start"],["type","datetime-local","id","inp-start","formControlName","dateTime"],["formGroupName","end"],["for","inp-end"],["type","datetime-local","id","inp-end","formControlName","dateTime"],[1,"form-actions"],["type","submit"],[1,"material-symbols-outlined"]],template:function(e,n){1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(1,"label",1),t._uU(2,"Summary"),t.qZA(),t._UZ(3,"input",2),t.ynx(4,3),t.TgZ(5,"label",4),t._uU(6,"Start"),t.qZA(),t._UZ(7,"input",5),t.BQk(),t.ynx(8,6),t.TgZ(9,"label",7),t._uU(10,"End"),t.qZA(),t._UZ(11,"input",8),t.BQk(),t.TgZ(12,"div",9)(13,"button",10)(14,"i",11),t._uU(15,"save"),t.qZA(),t._uU(16," Save "),t.qZA()()()),2&e&&t.Q6J("formGroup",n.formGroup)},dependencies:[l.ez,d.UX,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,d.x0],styles:["form[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr}form[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{display:flex;flex-direction:row;font-weight:700}"]});const M="https://www.googleapis.com/calendar/v3/calendars/primary/events";class k{constructor(e,n){this.tokenService=e,this.http=n}getAll(e){return this.tokenService.getAuthorizationHeader().pipe((0,f.w)(n=>this.http.get(M,{headers:{Authorization:n},params:e})),(0,m.U)(S.B2))}create(e){return this.tokenService.getAuthorizationHeader().pipe((0,f.w)(n=>this.http.post(M,e,{headers:{Authorization:n}})),(0,m.U)(S.RC))}}k.\u0275fac=function(e){return new(e||k)(t.LFG(g),t.LFG(j.eN))},k.\u0275prov=t.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"});class w{constructor(e){this.dataService=e}onSubmit(e){this.dataService.create(e).pipe((0,L.q)(1)).subscribe(()=>history.back())}}function fe(o,e){if(1&o&&(t.TgZ(0,"a",2),t._uU(1),t.TgZ(2,"span",3),t._uU(3),t.qZA()()),2&o){const n=e.$implicit,r=t.oxw();t.Q6J("href",n.htmlLink,t.LSH),t.xp6(1),t.hij(" ",n.summary," "),t.xp6(2),t.Oqu(r.displayEventTimeRange(n))}}w.\u0275fac=function(e){return new(e||w)(t.Y36(k))},w.\u0275cmp=t.Xpm({type:w,selectors:[["google-event-create-page"]],standalone:!0,features:[t.jDz],decls:1,vars:0,consts:[[3,"dataSubmited"]],template:function(e,n){1&e&&(t.TgZ(0,"google-event-form",0),t.NdJ("dataSubmited",function(i){return n.onSubmit(i)}),t.qZA())},dependencies:[l.ez,C]});class b{constructor(){this.displayEventTimeRange=S.sr}ngOnInit(){if(!this.data)throw new Error("Property 'data' is required!")}}function me(o,e){1&o&&t._UZ(0,"google-events-list",5),2&o&&t.Q6J("data",e.ngIf)}function ge(o,e){1&o&&(t.TgZ(0,"div"),t._uU(1,"Loading..."),t.qZA())}b.\u0275fac=function(e){return new(e||b)},b.\u0275cmp=t.Xpm({type:b,selectors:[["google-events-list"]],inputs:{data:"data"},standalone:!0,features:[t.jDz],decls:2,vars:1,consts:[[1,"cmp-list"],["target","_blank",3,"href",4,"ngFor","ngForOf"],["target","_blank",3,"href"],[1,"cmp-list-item-second"]],template:function(e,n){1&e&&(t.TgZ(0,"nav",0),t.YNc(1,fe,4,3,"a",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",n.data.items))},dependencies:[l.ez,l.sg]});class A{constructor(e){this.eventsService=e,this.data$=this.eventsService.getAll({singleEvents:!0,orderBy:"startTime",timeMin:new Date(Date.now()-2592e6).toISOString()})}}A.\u0275fac=function(e){return new(e||A)(t.Y36(k))},A.\u0275cmp=t.Xpm({type:A,selectors:[["google-events-list-page"]],standalone:!0,features:[t.jDz],decls:11,vars:4,consts:[[1,"cmp-nav-links"],["routerLink","create"],[1,"material-symbols-outlined"],[3,"data",4,"ngIf","ngIfElse"],["loading",""],[3,"data"]],template:function(e,n){if(1&e&&(t.TgZ(0,"nav")(1,"ul",0)(2,"li")(3,"a",1)(4,"i",2),t._uU(5,"add"),t.qZA(),t._uU(6," Create "),t.qZA()()()(),t.YNc(7,me,1,1,"google-events-list",3),t.ALo(8,"async"),t.YNc(9,ge,2,0,"ng-template",null,4,t.W1O)),2&e){const r=t.MAs(10);t.xp6(7),t.Q6J("ngIf",t.lcZ(8,2,n.data$))("ngIfElse",r)}},dependencies:[l.ez,l.O5,l.Ov,h.Bz,h.rH,b],styles:[".cmp-nav-links[_ngcontent-%COMP%]{justify-content:flex-start}"]});class x{}function ve(o,e){if(1&o){const n=t.EpF();t.ynx(0),t.TgZ(1,"div",4),t._UZ(2,"span",5),t.TgZ(3,"button",6),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.forecTokenExpired())}),t.TgZ(4,"i",7),t._uU(5,"refresh"),t.qZA(),t._uU(6," Expire Access Token "),t.qZA(),t.TgZ(7,"button",8),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.deleteToken())}),t.TgZ(8,"i",7),t._uU(9,"delete_forever"),t.qZA(),t._uU(10," Delete Access Token "),t.qZA()(),t._UZ(11,"router-outlet"),t.BQk()}}function ye(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",4)(1,"button",9),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.login())}),t.TgZ(2,"i",7),t._uU(3,"login"),t.qZA(),t._uU(4," Login to Google "),t.qZA()()}}function Te(o,e){1&o&&(t.TgZ(0,"div"),t._uU(1,"Loading..."),t.qZA())}x.\u0275fac=function(e){return new(e||x)},x.\u0275cmp=t.Xpm({type:x,selectors:[["google-root"]],standalone:!0,features:[t.jDz],decls:8,vars:0,consts:[[1,"cmp-nav-links"],["routerLink","events","routerLinkActive","st-active"],[1,"material-symbols-outlined"]],template:function(e,n){1&e&&(t.TgZ(0,"nav")(1,"ul",0)(2,"li")(3,"a",1)(4,"i",2),t._uU(5,"event"),t.qZA(),t._uU(6," Events "),t.qZA()()()(),t._UZ(7,"router-outlet"))},dependencies:[l.ez,h.Bz,h.lC,h.rH,h.Od]});class Z{constructor(e){this.tokenService=e,this.tokenReady$=this.tokenService.tokenReady$}login(){this.tokenService.getAuthorizationLink().pipe((0,L.q)(1)).subscribe(e=>location.href=e.toString())}forecTokenExpired(){this.tokenService.forceExpired()}deleteToken(){this.tokenService.deleteToken()}}Z.\u0275fac=function(e){return new(e||Z)(t.Y36(g))},Z.\u0275cmp=t.Xpm({type:Z,selectors:[["google-require-token"]],standalone:!0,features:[t.jDz],decls:5,vars:5,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],["class","cmp-actions",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"cmp-actions"],[1,"cl-filler"],["type","button",1,"cl-accent",3,"click"],[1,"material-symbols-outlined"],["type","button",1,"cl-warn",3,"click"],["type","button",1,"cl-primary",3,"click"]],template:function(e,n){1&e&&(t.ynx(0,0),t.ALo(1,"async"),t.YNc(2,ve,12,0,"ng-container",1),t.YNc(3,ye,5,0,"div",2),t.YNc(4,Te,2,0,"div",3),t.BQk()),2&e&&(t.Q6J("ngSwitch",t.lcZ(1,3,n.tokenReady$)),t.xp6(2),t.Q6J("ngSwitchCase",!0),t.xp6(1),t.Q6J("ngSwitchCase",!1))},dependencies:[l.ez,l.RF,l.n9,l.ED,l.Ov,h.Bz,h.lC]});const ke=[{path:"",component:x,children:[{path:"",component:Z,children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:A},{path:"events/create",component:w}]},{path:"authorization",component:D}]}]}}]);