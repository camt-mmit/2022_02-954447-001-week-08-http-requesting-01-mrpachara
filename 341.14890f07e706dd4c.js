"use strict";(self.webpackChunkmy_api_app=self.webpackChunkmy_api_app||[]).push([[341],{3341:(ye,b,a)=>{a.r(b),a.d(b,{routes:()=>me});var u=a(6895),I=a(5698),n=a(8274);function R(s,e,t,r,o,i,c){try{var d=s[i](c),p=d.value}catch(g){return void t(g)}d.done?e(p):Promise.resolve(p).then(r,o)}function l(s){return function(){var e=this,t=arguments;return new Promise(function(r,o){var i=s.apply(e,t);function c(p){R(i,r,o,c,d,"next",p)}function d(p){R(i,r,o,c,d,"throw",p)}c(void 0)})}}var Y=a(1135),q=a(727);class J extends q.w0{constructor(e,t){super()}schedule(e,t=0){return this}}const C={setInterval(s,e,...t){const{delegate:r}=C;return r?.setInterval?r.setInterval(s,e,...t):setInterval(s,e,...t)},clearInterval(s){const{delegate:e}=C;return(e?.clearInterval||clearInterval)(s)},delegate:void 0};var B=a(8737);const z={now:()=>(z.delegate||Date).now(),delegate:void 0};class T{constructor(e,t=T.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}}T.now=z.now;const Q=new class K extends T{constructor(e,t=T.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}(class M extends J{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;const o=this.id,i=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(i,o,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,r=0){return C.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&C.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let o,r=!1;try{this.work(e)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,B.P)(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});var F=a(4482),G=a(5403),X=a(4671);function W(s,e){return s===e}var ee=a(9635),v=a(3900),m=a(2076),L=a(2843),Z=a(9646),y=a(4004),te=a(3099),S=a(8959);function O(s){const e=new Uint32Array(s/2);return crypto.getRandomValues(e),Array.from(e,t=>("0"+t.toString(16)).slice(-2)).join("")}function P(){return(P=l(function*(s){const t=(new TextEncoder).encode(s);return crypto.subtle.digest("SHA-256",t)})).apply(this,arguments)}var N=a(529),h=a(955);const E="google-token",U="google-state-",$="https://oauth2.googleapis.com/token";class f{constructor(e,t,r){this.configuration=e,this.http=t,this.router=r,this.tokenReadySubject=new Y.X(null),this.tokenReady$=this.tokenReadySubject.asObservable().pipe(function H(s,e=Q){return(0,F.e)((t,r)=>{let o=null,i=null,c=null;const d=()=>{if(o){o.unsubscribe(),o=null;const g=i;i=null,r.next(g)}};function p(){const g=c+s,j=e.now();if(j<g)return o=this.schedule(void 0,g-j),void r.add(o);d()}t.subscribe((0,G.x)(r,g=>{i=g,c=e.now(),o||(o=e.schedule(p,s),r.add(o))},()=>{d(),r.complete()},void 0,()=>{i=o=null}))})}(100),function V(s,e=X.y){return s=s??W,(0,F.e)((t,r)=>{let o,i=!0;t.subscribe((0,G.x)(r,c=>{const d=e(c);(i||!s(o,d))&&(i=!1,o=d,r.next(c))}))})}()),this.storeTokenDataPipe=(0,ee.z)((0,v.w)(o=>(0,m.D)(this.storeTokenData(o)))),(0,m.D)(this.getAvailableTokenData()).subscribe(({available:o,tokenData:i})=>{null===this.tokenReadySubject.value&&this.tokenReadySubject.next(o||void 0!==i?.refresh_token)})}loadData(e){return l(function*(){return JSON.parse(localStorage.getItem(e)??"null")})()}storeData(e,t){return l(function*(){return localStorage.setItem(e,JSON.stringify(t))})()}removeData(e){return l(function*(){return localStorage.removeItem(e)})()}loadKeys(){return l(function*(){const e=[];for(let t=0;t<localStorage.length;t++)e.push(localStorage.key(t)??"");return e})()}loadStateData(e){var t=this;return l(function*(){const r=Date.now(),o=`${U}${e}`;for(const i of yield t.loadKeys())i.startsWith(U)&&((yield t.loadData(i))?.expiredAt??0)<=r&&t.removeData(i);return t.loadData(o)})()}storeStateData(e,t){var r=this;return l(function*(){const o={...t,expiredAt:Date.now()+6e5};return yield r.storeData(`${U}${e}`,o),o})()}removeStateData(e){var t=this;return l(function*(){const r=yield t.loadStateData(e);return yield t.removeData(`${U}${e}`),r})()}loadTokenData(){var e=this;return l(function*(){return yield e.loadData(E)})()}storeTokenData(e){var t=this;return l(function*(){const r=Date.now(),o={...e},i=yield t.loadTokenData();return!o.refresh_token&&i?.refresh_token&&(o.refresh_token=i.refresh_token),void 0===o.expiredAt&&(o.expiredAt=r+1e3*o.expires_in-1e4),yield t.storeData(E,o),t.tokenReadySubject.next(!0),o})()}removeTokenData(){var e=this;return l(function*(){yield e.removeData(E),e.tokenReadySubject.next(!1)})()}refreshTokenData(e){return this.http.post($,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:e}).pipe(this.storeTokenDataPipe)}exchangeCodeForToken(e,t,r){return(0,m.D)(this.removeStateData(t)).pipe((0,v.w)(o=>r?(0,L._)(()=>r):(0,Z.of)(o)),(0,v.w)(o=>o?this.http.post($,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:e,code_verifier:o.verifierCode,grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe(this.storeTokenDataPipe,(0,y.U)(()=>o)):(0,L._)(()=>new S.YP(t))))}getAuthorizationLink(){const e=O(56);return(0,m.D)(function oe(s){return P.apply(this,arguments)}(e)).pipe((0,y.U)(t=>function ne(s,e=!1){let t="";const r=new Uint8Array(s),o=r.byteLength;for(let c=0;c<o;c++)t+=String.fromCharCode(r[c]);const i=btoa(t);return e?function re(s){return s.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(i):i}(t,!0)),(0,v.w)(t=>{const r=O(16);return(0,m.D)(this.storeStateData(r,{verifierCode:e,redirectUrl:this.router.url})).pipe((0,y.U)(()=>({challengeCode:t,securityToken:r})))}),(0,y.U)(({challengeCode:t,securityToken:r})=>{const o=new URL("https://accounts.google.com/o/oauth2/v2/auth");return o.searchParams.set("response_type","code"),o.searchParams.set("client_id",this.configuration.client_id),o.searchParams.set("scope",this.configuration.scopes.join(" ")),o.searchParams.set("redirect_uri",this.configuration.redirect_uri),o.searchParams.set("code_challenge",t),o.searchParams.set("code_challenge_method","S256"),o.searchParams.set("state",new URLSearchParams({security_token:r}).toString()),o.searchParams.append("prompt","consent"),o.searchParams.append("access_type","offline"),o}))}getAvailableTokenData(){return(0,m.D)(this.loadTokenData()).pipe((0,y.U)(e=>{const t=Date.now();return{available:(e?.expiredAt??0)>t,tokenData:e}}))}tryGetTokenData(){return(0,m.D)(this.getAvailableTokenData()).pipe((0,v.w)(({available:e,tokenData:t})=>e||void 0!==t?.refresh_token?this.refreshTokenData(t?.refresh_token??""):(0,Z.of)(null)),(0,te.B)())}getAccessToken(){return this.tryGetTokenData().pipe((0,y.U)(e=>e?.access_token??null))}getAuthorizationHeader(){return this.tryGetTokenData().pipe((0,v.w)(e=>e?(0,Z.of)(`${e.token_type} ${e.access_token}`):(0,L._)(()=>new S.kG)))}forceExpired(){var e=this;return l(function*(){const t=yield e.loadTokenData();t&&(t.expiredAt=0,yield e.storeTokenData(t))})()}deleteToken(){var e=this;return l(function*(){yield e.removeTokenData()})()}}f.\u0275fac=function(e){return new(e||f)(n.LFG(S.tL),n.LFG(N.eN),n.LFG(h.F0))},f.\u0275prov=n.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"});class D{constructor(e,t,r){this.tokenService=e,this.route=t,this.router=r,this.errorMessage=null}ngOnInit(){const e=this.route.snapshot.queryParams,t=new URLSearchParams(e.state).get("security_token");e.code&&t&&this.tokenService.exchangeCodeForToken(e.code,t,e.error).pipe((0,I.q)(1)).subscribe({next:r=>this.router.navigateByUrl(r.redirectUrl),error:r=>{this.errorMessage=r.error?.error?r.error?.error:r instanceof Error?r.message:r}})}}function ue(s,e){if(1&s&&(n.TgZ(0,"a",2),n._uU(1),n.TgZ(2,"span",3),n._uU(3),n.qZA()()),2&s){const t=e.$implicit,r=n.oxw();n.Q6J("href",t.htmlLink,n.LSH),n.xp6(1),n.hij(" ",t.summary," "),n.xp6(2),n.Oqu(r.displayEventTimeRange(t))}}D.\u0275fac=function(e){return new(e||D)(n.Y36(f),n.Y36(h.gz),n.Y36(h.F0))},D.\u0275cmp=n.Xpm({type:D,selectors:[["google-authorization-page"]],standalone:!0,features:[n.jDz],decls:2,vars:1,template:function(e,t){1&e&&(n.TgZ(0,"p"),n._uU(1),n.qZA()),2&e&&(n.xp6(1),n.Oqu(t.errorMessage))},dependencies:[u.ez]});class w{constructor(){this.displayEventTimeRange=S.sr}ngOnInit(){if(!this.data)throw new Error("Property 'data' is required!")}}w.\u0275fac=function(e){return new(e||w)},w.\u0275cmp=n.Xpm({type:w,selectors:[["google-events-list"]],inputs:{data:"data"},standalone:!0,features:[n.jDz],decls:2,vars:1,consts:[[1,"cmp-list"],["target","_blank",3,"href",4,"ngFor","ngForOf"],["target","_blank",3,"href"],[1,"cmp-list-item-second"]],template:function(e,t){1&e&&(n.TgZ(0,"nav",0),n.YNc(1,ue,4,3,"a",1),n.qZA()),2&e&&(n.xp6(1),n.Q6J("ngForOf",t.data.items))},dependencies:[u.ez,u.sg]});class k{constructor(e,t){this.tokenService=e,this.http=t}getAll(e){return this.tokenService.getAuthorizationHeader().pipe((0,v.w)(t=>this.http.get("https://www.googleapis.com/calendar/v3/calendars/primary/events",{headers:{Authorization:t},params:e}).pipe((0,y.U)(S.B2))))}}function he(s,e){1&s&&n._UZ(0,"google-events-list",2),2&s&&n.Q6J("data",e.ngIf)}function fe(s,e){1&s&&(n.TgZ(0,"div"),n._uU(1,"Loading..."),n.qZA())}k.\u0275fac=function(e){return new(e||k)(n.LFG(f),n.LFG(N.eN))},k.\u0275prov=n.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"});class x{constructor(e){this.eventsService=e,this.data$=this.eventsService.getAll({singleEvents:!0,orderBy:"startTime",timeMin:new Date(Date.now()-2592e6).toISOString()})}}x.\u0275fac=function(e){return new(e||x)(n.Y36(k))},x.\u0275cmp=n.Xpm({type:x,selectors:[["google-events-list-page"]],standalone:!0,features:[n.jDz],decls:4,vars:4,consts:[[3,"data",4,"ngIf","ngIfElse"],["loading",""],[3,"data"]],template:function(e,t){if(1&e&&(n.YNc(0,he,1,1,"google-events-list",0),n.ALo(1,"async"),n.YNc(2,fe,2,0,"ng-template",null,1,n.W1O)),2&e){const r=n.MAs(3);n.Q6J("ngIf",n.lcZ(1,2,t.data$))("ngIfElse",r)}},dependencies:[u.ez,u.O5,u.Ov,w]});class A{}function pe(s,e){if(1&s){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",4),n._UZ(2,"span",5),n.TgZ(3,"button",6),n.NdJ("click",function(){n.CHM(t);const o=n.oxw();return n.KtG(o.forecTokenExpired())}),n.TgZ(4,"i",7),n._uU(5,"refresh"),n.qZA(),n._uU(6," Expire Access Token "),n.qZA(),n.TgZ(7,"button",8),n.NdJ("click",function(){n.CHM(t);const o=n.oxw();return n.KtG(o.deleteToken())}),n.TgZ(8,"i",7),n._uU(9,"delete_forever"),n.qZA(),n._uU(10," Delete Access Token "),n.qZA()(),n._UZ(11,"router-outlet"),n.BQk()}}function ge(s,e){if(1&s){const t=n.EpF();n.TgZ(0,"div",4)(1,"button",9),n.NdJ("click",function(){n.CHM(t);const o=n.oxw();return n.KtG(o.login())}),n.TgZ(2,"i",7),n._uU(3,"login"),n.qZA(),n._uU(4," Login to Google "),n.qZA()()}}function ve(s,e){1&s&&(n.TgZ(0,"div"),n._uU(1,"Loading..."),n.qZA())}A.\u0275fac=function(e){return new(e||A)},A.\u0275cmp=n.Xpm({type:A,selectors:[["google-root"]],standalone:!0,features:[n.jDz],decls:8,vars:0,consts:[[1,"cmp-nav-links"],["routerLink","events","routerLinkActive","st-active"],[1,"material-symbols-outlined"]],template:function(e,t){1&e&&(n.TgZ(0,"nav")(1,"ul",0)(2,"li")(3,"a",1)(4,"i",2),n._uU(5,"event"),n.qZA(),n._uU(6," Events "),n.qZA()()()(),n._UZ(7,"router-outlet"))},dependencies:[u.ez,h.Bz,h.lC,h.rH,h.Od]});class _{constructor(e){this.tokenService=e,this.tokenReady$=this.tokenService.tokenReady$}login(){this.tokenService.getAuthorizationLink().pipe((0,I.q)(1)).subscribe(e=>location.href=e.toString())}forecTokenExpired(){this.tokenService.forceExpired()}deleteToken(){this.tokenService.deleteToken()}}_.\u0275fac=function(e){return new(e||_)(n.Y36(f))},_.\u0275cmp=n.Xpm({type:_,selectors:[["google-require-token"]],standalone:!0,features:[n.jDz],decls:5,vars:5,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],["class","cmp-actions",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"cmp-actions"],[1,"cl-filler"],["type","button",1,"cl-accent",3,"click"],[1,"material-symbols-outlined"],["type","button",1,"cl-warn",3,"click"],["type","button",1,"cl-primary",3,"click"]],template:function(e,t){1&e&&(n.ynx(0,0),n.ALo(1,"async"),n.YNc(2,pe,12,0,"ng-container",1),n.YNc(3,ge,5,0,"div",2),n.YNc(4,ve,2,0,"div",3),n.BQk()),2&e&&(n.Q6J("ngSwitch",n.lcZ(1,3,t.tokenReady$)),n.xp6(2),n.Q6J("ngSwitchCase",!0),n.xp6(1),n.Q6J("ngSwitchCase",!1))},dependencies:[u.ez,u.RF,u.n9,u.ED,u.Ov,h.Bz,h.lC]});const me=[{path:"",component:A,children:[{path:"",component:_,children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:x}]},{path:"authorization",component:D}]}]}}]);